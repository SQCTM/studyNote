# 渐进式网页应用

[TOC]

## 浏览器三大进化路线

- 应用程序Web化
- Web应用移动化
- Web操作系统化



## PWA

全称Progressive Web App，渐进式网页应用，即“渐进式+Web应用”。**渐进式增强Web的优势，并通过技术手段渐进式缩短和本地应用或小程序的距离**。

- **渐进式**

  - 站在Web应用开发者角度，PWA提供了一个渐进式的过渡方案，让普通站点逐步过渡到Web应用，采取渐进式可以降低站点改造的代价，使得站点逐步支持各项新技术，而不是一步到位
  - 站在技术角度，PWA技术也是一个渐进式的演化过程，在技术层面会一点点演进，比如逐渐提供更好的设备特性支持，不断优化更加流畅的动画效果，不断让页面的加载速度变得更快，不断实现本地应用的特性

  

## Web应用与本地应用

- **相对于本地应用Web页面缺少的东西**

  - Web应用**缺少离线使用能力**，在离线或在弱网环境下基本上是无法使用的。而用户需要的是沉浸式的体验，在离线或者弱网环境下能够流畅地使用是用户对一个应用的基本要求
  - Web应用**缺少一级入口**，也就是将Web应用安装到桌面，在需要的时候直接从桌面打开Web应用，而不是每次都需要通过浏览器打开

- **PWA解决方案**

  - 通过引入**Service Worker**来试着解决离线存储和消息推送问题

    - **原理**

      在页面和网络之间增加一个拦截器，用来**缓存**和**拦截请求**。WebApp请求资源时会先通过Service Worker让它判断是返回Service Worker缓存的资源还是重新去网络请求资源

    - **设计思路**

      - **架构**

        运行在主线程之外，加上储存功能，还需要为多个页面提供服务，不能把Service Worker和单个页面绑定起来，所以目前的Chrome架构中Service Worker运行在浏览器进程中，因为浏览器进程生命周期是最长的，所以在浏览器的声明周期内能够为所有页面提供服务

      - **消息推送**

        消息推送时浏览器页面也许没有启动，需要Service Worker来接收服务器推送的消息，并将消息通过一定方式展示给用户

      - **安全**

        关于安全最核心的一条就是HTTP，HTTP采用的是明文传输信息，存在被窃听、被篡改和被劫持的风险，在项目中使用HTTP来传输数据非常不安全，因此对Service Worker**采用HTTPS协议**，因为采用HTTPS的通信数据都是经过加密的，即便拦截了数据也无法破解数据内容，而且HTTPS还有校验机制，通信双方很容易知道数据是否被篡改

  - 通过引入**mainfest.json**来解决一级入口的问题