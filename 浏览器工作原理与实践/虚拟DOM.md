# 虚拟DOM

[TOC]

## DOM的缺陷

通过JS操纵DOM会影响到整个渲染流水线，降低渲染效率，非常耗时



## 虚拟DOM

- **解决的问题**

  - 将页面改变的内容应用到虚拟DOM上，而不是直接应用到DOM上
  - 变化被应用到虚拟DOM上时，虚拟DOM并不急着去渲染页面，而仅仅是调整虚拟DOM的内部状态，这样操作虚拟DOM的代价就变得非常轻了
  - 在虚拟DOM收集到足够的改变时，再把这些变化一次性应用到真实的DOM上

- **运行**

  - **创建阶段**

    首先依据JSX和基础数据创建出来虚拟DOM，它反映了真实的DOM树的结构，然后由虚拟DOM树创建出真实DOM树，真实的DOM树生成完后再触发渲染流水线往屏幕输出页面

  - **更新阶段**

    如果数据发生了改变，就需要根据新的数据创建一个新的虚拟DOM树，然后比较两个树找出变化的地方，并把变化的地方一次性更新到真实的DOM树上，最后渲染引擎更新渲染流水线并生成新的页面



## 双缓存

在开发游戏或处理其他图像的过程中，屏幕从前缓冲区读取数据然后显示。但是很多图形操作很复杂且需要大量运算，需要计算多次才能完成，如果每次计算完一部分图像就将其写入缓冲区会造成用户所看到的页面效果可能是一部分一部分地显示出来，因此在刷新页面的过程中会让用户感受到界面的闪烁

使用双缓存可以先将计算的中间结果存放在另一个缓冲区中，这样使得整个图像的输出非常稳定

