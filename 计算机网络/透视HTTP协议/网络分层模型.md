# 网络分层模型

[TOC]

## TCP/IP网络分层模型

总共有**四层**，每一层都需要下层的支撑，同时又支撑着上层，层次顺序**从下往上**：

1. **第一层：链接层**

   负责在以太网、WIFI这样的底层网络上发送原始数据包，工作在网卡这个层次，使用MAC地址来标记网络上的设备，所以也叫MAC层。传输单位是**帧**

2. **第二层：网际层/网络互连层**

   **IP协议**在这一层，IP协议定义了“IP地址”的概念，可以在链接层的基础上，用IP地址取代MAC地址，把许许多多的局域网、广域网连接成一个虚拟的巨大网络，在这个网络里找设备时只要把IP地址再“翻译”成MAC地址就可以了。传输单位是**包**

3. **第三层：传输层**

   - **TCP**

     保证数据在IP地址标记的两点之间可靠地传输，是TCP协议工程的层次。TCP是一个有状态的协议，需要先与对方建立连接然后才能发送数据，而且保证数据不丢失不重复。TCP的数据是连续的“字节流”，有先后顺序

   - **UDP**

     除TCP外还有UDP，UDP无状态，可以任意发送数据，但不保证数据一定会发送到对方。UDP是分散的小数据包，顺序发，乱序收

   - 传输单位是**段**

4. **第四层：应用层**

   有各种面向具体应用的协议，如HTTP等。HTTP的传输单位是**消息**或**报文**

*传输单位的名词没有本质区分，可以统称为**数据包**



## OSI网络分层模型

全称为**开放式系统互联通信参考模型**，分为**七层**，层次顺序**从下往上**：

1. **第一层：物理层**

   网络的物理形式

2. **第二层：数据链路层**

   基本相当于TCP/IP的链接层

3. **第三层：网络层**

   相当于TCP/IP里的网际层

4. **第四层：传输层**

   TCP在这一层，相当于TCP/IP里的传输层

5. **第五层：会话层**

   维护网络中的连接状态，即保持会话和同步

6. **第六层：表示层**

   把数据转换为合适、可理解的语法和语义

7. **第七层：应用层**

   HTTP在这一层，面向具体的应用传输数据

*是一个参考，不是强制标准

- **优点**
  - TCP/IP是一个纯软件的栈，没有网络应有的最根基的电缆、网卡等物理设备的位置，OSI则不足了这个缺失，在理论层面上描述网络更加完整
  - OSI为每一层标记了明确的编号，最底层是一层，最上层是七层，而TCP/IP的层次只有名字没有编号



## 两个分层模型的映射关系

1. 第一层：物理层，TCP/IP无对应
2. 第二层：数据链路层，对应TCP/IP的链接层
3. 第三层：网络层，对应TCP/IP的网际层
4. 第四层：传输层，对应TCP/IP的传输层
5. 第五、六、七层：统一对应到TCP/IP的应用层

*OSI的分层模型在四层以上分的太细，而TCP/IP实际应用时的会话管理、编码转换、压缩等和具体应用经常联系的很紧密，很难分开



## TCP/IP协议栈的工作方式

- **接收和传输数据**

  HTTP利用TCP/IP协议栈传输数据，传输过程就是通过协议栈逐层向下，每一层都添加本层的专有数据，层层打包，然后通过下层发送出去；接收数据则是相反的操作，从下往上穿过协议栈，逐层拆包，每层去掉本层的专有头，上层就会拿到自己的数据

- **下层的传输过程对于上层是完全透明的**，上层不需要关心下层的具体实现细节，所以就HTTP层次来看，它不管下层是不是TCP/IP协议，看到的只是一个可靠的传输链路，只要把数据加上自己的头，对方就能原样收到