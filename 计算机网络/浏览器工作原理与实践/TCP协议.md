# TCP协议

[TOC]

## FP指标

FP(First Paint)，是衡量Web页面性能的一个重要指标，指从页面加载到首次开始绘制的时长。影响FP指标的一个重要因素就是**网络加载速度**



## 数据包的传输

互联网中的数据是通过数据包来传输的，如果发送的数据很大，该数据会被拆分为很多小数据包来进行传输，但数据包在传输过程中有很大概率丢失或出错



1. **IP**：把数据包送达目的主机

   数据包要在互联网上进行传输就要符合**网络协议**（IP）标准。互联网上不同的在线设备都有唯一的地址，计算机的地址就称为IP地址，访问任何网站都是你的计算机向另外一台计算机请求信息

   - **IP将数据包从主机A传到主机B的过程**
     1. 主机A上层将数据包交给网络层
     2. 网络层将主机B的IP地址和主机A本身的IP地址装进**IP头**，再附加到数据包上，这样在传输过程中才能正确寻址，主机B也可以回复信息给主机A；这样组成新的**IP数据包**后，就交给底层
     3. 底层通过物理网络将数据包传输给主机B
     4. 数据包被传输到主机B的网络层，在这里主机B拆开数据包的IP头信息，并将拆开来的数据部分交给上层

2. **UDP**：把数据包送达应用程序

   IP只负责把数据包传到目的主机，而UDP即**用户数据包协议**则可以和应用程序打交道

   - **端口号**

     UDP最重要的一个信息就是端口号，UDP可以通过它把指定数据包发给指定的程序

   - **IP+UDP将数据包从主机A传到主机B的过程**

     1. 主机A上层将数据包交给传输层
     2. 传输层将目的端口号和源端口号等装进**UDP头**，UDP头和原始数据包合并组成新的**UDP数据包**再交给网络层
     3. 网络层将IP头附加到数据包上，组成新的IP数据包，再交给底层
     4. 数据包被传输到主机B的网络层，在这里主机B拆开IP头信息，将剩下的数据部分交给传输层
     5. 在传输层数据包中的UDP头被拆开，根据UDP中提供的端口号，把数据部分交给上层的应用程序

     ***即IP通过IP地址把数据包发送给指定的电脑，而UDP通过端口号把数据包分发给正确的程序**

   - **UDP传输问题**

     - 数据包在传输过程中容易丢失
     - 在传输过程中有各种因素会导致数据包出错，虽然UDP可以校验数据是否正确，但**对于错误的数据包，UDP不提供重发机制，仅丢弃当前的包**；而且**UDP发送后无法知道是否能到达目的地**
     - 大文件会被拆分成很多小数据包来传输，这些小的数据包会经过不同的路由，在不同时间到达接收端，而UDP协议不知道如何组装这些数据包，从而把数据包还原成完整的文件

   - UDP不能保证数据可靠性，但**传输速度非常快**

3. **TCP**：把数据完整地送达应用程序

   TCP是一种面向连接的、可靠的、基于字节流的传输层通信协议

   - **TCP特点**

     - 对于数据包丢失的情况，TCP提供重传机制
     - TCP引入了数据包排序机制，用来保证把乱序的数据包组合成一个完整的文件

   - **序列号**

     TCP头除了包含端口号，还提供了用于排序的序列号，以便接收端通过序号来重排数据包

   - **IP+TCP将数据包从主机A传到主机B的过程**

     1. 主机A上层将数据包交给传输层
     2. 传输层将**TCP头**和原始数据包合并组成新的**TCP数据包**再交给网络层
     3. 网络层将IP头附加到数据包上，组成新的IP数据包，再交给底层
     4. 数据包被传输到主机B的网络层，在这里主机B拆开IP头信息，将剩下的数据部分交给传输层
     5. 在传输层数据包中的TCP头被拆开，识别出提供的端口号，把数据部分交给上层的应用程序

   - **完整的TCP连接过程**

     1. **建立连接**

        通过“三次握手”建立客户端和服务器之间的连接，即客户端和服务器之间总共要发送三个数据包来建立一个TCP连接

     2. **传输数据**

        接收端需要对每个数据包进行确认操作，即接收端接收到数据包后需要发送确认数据包给发送端；发送端发送数据包后在规定时间内没有接收到接收端的反馈，则判断为数据包丢失，并触发重发机制。且数据包在到达接收端后接收端会按照TCP头中的序号为其排序，保证组成完整的数据

     3. **断开连接**

        数据传输完毕之后就要终止连接，通过“四次挥手”来保证双方都能断开连接

     ![image-20200920155703914](C:\Users\aa\AppData\Roaming\Typora\typora-user-images\image-20200920155703914.png)

