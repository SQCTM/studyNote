# 函数的扩展

[TOC]

## 参数的默认值

```javascript
function(x, y='world') {
    console.log(x, y);
}
```

- **注意点**

  - **参数默认值设为undefined表示该参数可省略**

  - **null不能触发参数默认值**

    只有undefined才可以，null无效

  - **不能再次声明**

    ```javascript
    //参数变量是默认声明的，所以不能用let或const再次声明
    function foo(x = 5) {
        let x = 1;    //error
        const x = 2;  //error
    }
    ```

  - **不计入length属性**

    函数的length属性的含义是该函数预期传入的参数个数

    *如果设置了默认值的参数不是尾参数，该参数之后的参数也不计入length属性

    ```javascript
    (function (a) {}).length // 1
    (function (a = 5) {}).length // 0
    (function (a, b, c = 5) {}).length // 2
    (function (a = 0, b, c) {}).length // 0
    (function (a, b = 1, c) {}).length // 1
    ```

  - **参数默认值是惰性求值**

    ```javascript
    let x = 99;
    function foo(p = x + 1) {
      console.log(p);
    }
    foo();  //100
    
    x = 100;
    foo();  //101
    //每次调用函数都会重新计算x+1，而不是默认p等于100
    ```

- **双重默认**

  ```javascript
  function fetch(url, {method = 'GET'} = {}){
      console.log(method);
  }
  fetch('http://example.com');   //GET
  ```

- **参数默认值的位置**

  通常定义了默认值的参数应该是函数的为参数，因为这样更容易看出省略了哪些参数。而且如果非尾部的参数设置默认值无法只省略该参数而不省略其后的参数，除非显式输入undefined

  ```javascript
  function f(x = 1, y) {
    return [x, y];
  }
  f();    //[1, undefined]
  f(2);   //[2, undefined]
  f(,1);  //报错
  f(undefined, 1);  //[1, 1]
  ```

- **作用域**

  设置了参数的默认值函数进行声明初始化时，参数会形成一个单独的作用域(context)，等到初始化结束该作用域会消失。这种语法行为在不设置参数默认值时不会出现。

  ```javascript
  var x = 1;
  function f(x, y = x) {
    console.log(y);
  }
  f(2) // 2
  //调用函数f时，参数形成一个单独的作用域。在这个作用域里面，默认值变量x指向第一个参数x，而不是全局变量x
  
  let x = 1;
  function f(y = x) {   //全局变量x不存在就会报错
    let x = 2;
    console.log(y);
  }
  f() // 1
  //参数y = x形成一个单独的作用域。这个作用域里面，变量x本身没有定义，所以指向外层的全局变量x
  ```

  

## rest参数

用于获取函数的多余参数，这样就不需要arguments对象。rest参数搭配的变量是一个数组，将多余的参数放入其中

```javascript
function add(...values) {
  let sum = 0;
  for (var val of values) {
    sum += val;
  }
  return sum;
}
add(2, 5, 3) // 10
```

- **注意点**

  - **rest参数必须是最后一个参数**

    rest参数之后不能再有其他参数，必须是函数的最后一个参数，否则会报错

  - **不计入length属性**

    rest参数不计入函数的length属性

  - **可以使用所有数组特有方法**



## name属性

返回该函数的函数名，虽然这个属性早就被浏览器广泛支持，但直到ES6才写入标准

- **改动**

  如果一个匿名函数赋值给一个变量，ES5 的nam属性会返回空字符串，而 ES6 的name属性会返回实际的函数名

  ```javascript
  var f = function () {};
  // ES5
  f.name // ""
  // ES6
  f.name // "f"
  ```

- **特点**

  - Function**构造函数**返回的函数实例，name属性的值为anonymous

    ```javascript
    (new Function).name  // "anonymous"
    ```

  - **bind返回的函数**，name属性值会加上bound前缀

    ```javascript
    function foo() {};
    foo.bind({}).name // "bound foo"
    
    (function(){}).bind({}).name // "bound "
    ```

    

## 箭头函数

- **基本用法**
- **注意点**
  - 函数体内的this对象，就是定义时所在的对象，而不是使用时所在的对象
  - 不可以当作构造函数，即不可以使用new命令，否则会抛出一个错误
  - 不可以使用arguments对象，该对象在函数体内不存在。可以用 rest 参数代替
  - 不可以使用yield命令，因此箭头函数不能用作Generator函数。
- **嵌套**



## 绑定this





## 尾调用优化

- **尾调用**
- **尾调用优化**
- **尾递归**
- **尾递归优化**



## 参数的尾逗号

ES2017 [允许](https://github.com/jeffmo/es-trailing-function-commas)函数的最后一个参数有尾逗号。此前，函数定义和调用时都不允许最后一个参数后面出现逗号

这样的规定使得函数参数与数组和对象的尾逗号规则保持一致